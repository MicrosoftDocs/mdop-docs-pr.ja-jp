---
title: MED-V ワークスペースの自動更新の管理
description: MED-V ワークスペースの自動更新の管理
author: dansimp
ms.assetid: 306f28a2-d653-480d-b737-4b8b3132de5d
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: b22d3250db806e740c1d62da4fed98d5956b0eeb
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/26/2020
ms.locfileid: "10825294"
---
# MED-V ワークスペースの自動更新の管理


MED-V ワークスペースは、個別のオペレーティングシステムを含む仮想マシンであり、自動ソフトウェア更新プロセスは、企業の物理コンピューターと同じように管理する必要があります。 ゲストオペレーティングシステムは、ホストのオペレーティングシステムが実行されているときに必ずしも実行されるとは限りません。そのため、必要に応じてゲストオペレーティングシステムにソフトウェアの更新プログラムを適用できるように、MED-V 仮想マシンが構成されていることを確認する必要があります。 Microsoft Enterprise Desktop Virtualization (MED) 2.0 ソリューションには、MED-V ワークスペースでの自動ソフトウェア更新プログラムの処理方法を決定できる機能が用意されています。

## MED-V ワークスペースのウェイクアップポリシーを管理する


MED-V workspace ウェークアップポリシーは、med-v 仮想マシンが、MED-V 構成設定で指定した時間の間、更新が利用できるようにすることを保証します。 これは、microsoft から公開された更新プログラムや更新プログラム、および Microsoft 以外のソリューション (ウイルス対策アプリケーションなど) によって展開および管理される更新プログラムに適用されます。

**重要** MED-V ワークスペースのウェイクアップポリシーは、Microsoft Update インフラストラクチャに最適化されています。 Microsoft System Center Configuration Manager を使用して Microsoft 以外の更新プログラムを展開している場合は、System Center Updates Publisher も使用することをお勧めします。これにより、Microsoft Update と同じインフラストラクチャを活用します。そのため、MED-V ワークスペースのウェイクアップポリシーを利用すると便利です。 詳細については、「 [System Center Updates Publisher](https://go.microsoft.com/fwlink/?LinkId=200035) (」を参照してください https://go.microsoft.com/fwlink/?LinkId=200035) 。

 

MED-V ワークスペースパッケージを作成した場合、エンドユーザーがログオンするタイミングと開始方法 (**ファストスタート**)、またはエンドユーザーが公開されたアプリケーション (**正常起動時**) を最初に開くときに構成します。 または、エンドユーザーがこの設定を制御できるようにオプションを設定します。

どちらの場合も、**ファストスタート**オプションが選択されているときは、med-v ホストがユーザーとしてログオンしている限り、仮想マシンの実行が続行されます。 この構成では、ホストがアクティブなときに MED-V がアクティブになるため、MED-V からの追加の処理を必要とせずに、自動更新が適用されます。

ただし、**ファストスタート**が指定されていない場合、または仮想マシンの休止状態または停止時に、med-v が定期的に使用されていない場合でも、ゲストオペレーティングシステムが定期的に更新されている、med-v ワークスペースのウェイクアップポリシーを通じて、med-v が保証されます。 MED-V は、指定した構成設定に基づいて仮想マシンを定期的にスリープ状態にして、この機能を実行します。 これにより、仮想マシンの自動更新クライアントが、その構成に基づいて実行されるようになります。MED-V 構成設定で定義された期間が経過すると、MED-V は仮想マシンを前の状態に戻します。

**注** エンドユーザーが更新期間中に公開されたアプリケーションを開くと、必要な更新プログラムが適用されますが、MED-V は更新期間が終了した後に自動的に休止されたり、シャットダウンされたりすることはありません。 代わりに、MED-V は実行され続けます。

 

MED-V ワークスペースのウェイクアップポリシーには、3つの主なコンポーネントが含まれています。

**ゲスト更新マネージャー**

MED-V ホストに常駐している場合は、スタンドアロンの実行可能プログラムによって、事前定義されたスケジュールに従って仮想マシンを起動する必要があります。 更新プログラムマネージャーによる仮想マシンのアクティブな実行時間、更新プログラムの適用を許可するために仮想マシンをスリープ状態にする時間 (分) を指定する構成設定を指定します。 指定した分数が経過すると、ゲスト更新マネージャーによって仮想マシンが休止状態になり、次の使用のために準備されます。 Windows タスクマネージャーを使って、この実行可能プログラムの実行をスケジュールできます。

**ゲストの再起動管理サービス**

MED-V ホストに常駐している場合、このサービスには3つの主な責任があります。 ゲスト更新マネージャーと共に、必要に応じて、ユーザーログオン時に仮想マシンの再起動を管理します。 更新プログラムがインストールされているために、仮想マシンの再起動が必要になることが検出されます。 また、ゲスト更新マネージャーのタスクは、常に構成に従ってスケジュールされます。

**ゲスト更新サービス**

MED-V 仮想マシン上に存在する場合、この Windows サービスは、インストールされている更新プログラムの再起動が必要な場合に監視する必要があります。 サービスが再起動の必要性を認識すると、ホストでゲストの再起動管理サービスに通知されます。

### MED-V Workspace ウェイクアップポリシーの構成設定

仮想マシンで自動更新を受信するタイミングと時間を制御するには、レジストリで次の2つの構成値を定義します。 これらの値はどちらも、HKLM\\Software\\Microsoft\\MEDV\\v2\\VM キーの下にあります。

**Guestupdatetime** – MED が24時間制の標準に基づいて更新のために仮想マシンをウェイクアップするときの時間と分を構成します。 HH: MM の形式で時刻を指定します。 既定値は、00:00 (深夜) です。

**Guestupdateduration** – med-v が仮想マシンの更新を開始するまでの時間を分単位で構成します。これは、Guestupdateduration 構成の設定で指定された時間になります。 既定値は 240 (4 時間) です。 この値をゼロ (0) に設定すると、MED-V workspace ウェイクアップポリシーが無効になります。

MED-V 構成値の定義方法の詳細については、「 [Med-v ワークスペース構成設定を管理](managing-med-v-workspace-configuration-settings.md)する」を参照してください。

**注** MED-V のベストプラクティスは、MED-V 仮想マシンが定期的に更新される予定の時刻に合わせて、スリープ状態を設定することです。 また、これらの設定は、ホストコンピューターの動作に似た構成にすることをお勧めします。

 

### ESD システムを使った再起動通知

自動更新が適用された後に、MED-V ワークスペースの再起動が必要になるたびに、MED-V に通知するように ESD システムを構成することができます。 再起動が必要であることがわかっている ESD システムで自動更新を適用する場合は、MED-V ワークスペースで次のグローバルイベントを通知するスクリプトを作成する必要があります。

**重要** [変更] 権限を持つイベントを開き、シグナルを送る必要があります。 適切な権限を持っていない場合は、正常に動作しません。

 

``` syntax
/// <summary>
/// The guest is required to be restarted due to an ESD update.
/// </summary>
public const string MedvGuestRebootRequiredEventName = @"Global\MedvGuestRebootRequiredEvent";
using (EventWaitHandle notificationEvent = 
EventWaitHandle.OpenExisting(eventName, EventWaitHandleRights.Modify))
{
notificationEvent.Set();
}
```

このイベントを通知すると、MED-V がキャプチャされ、再起動が必要であることが仮想マシンに通知されます。

## 関連トピック


[MED-V ワークスペースのソフトウェア更新プログラムの管理](managing-software-updates-for-med-v-workspaces.md)

 

 





