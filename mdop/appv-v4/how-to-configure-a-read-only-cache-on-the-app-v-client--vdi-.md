---
title: App-V Client の読み取り専用キャッシュを構成する方法 (VDI)
description: App-V Client の読み取り専用キャッシュを構成する方法 (VDI)
author: dansimp
ms.assetid: 7a41e017-9e23-4a6a-a659-04d23f008b83
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, appcompat, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: 114f9dfbf55a3f62b6bc8bec6b37a659ffbfaf56
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/26/2020
ms.locfileid: "10817944"
---
# App-V Client の読み取り専用キャッシュを構成する方法 (VDI)


Microsoft Application Virtualization (App-v) 4.6 では、クライアントは共有読み取り専用キャッシュの使用をサポートしています。 共有読み取り専用キャッシュを使用すると、クライアントは仮想デスクトップインフラストラクチャ (VDI) システムでディスク領域を効率的に使うことができます。このシステムでは、ユーザーがデータセンターサーバー環境でホストされている仮想マシン (VM) でアプリケーションを実行し、記憶域ネットワーク (SAN) でネットワークストレージを共有します。 次の手順では、"プールされた VM" または "静的 VM" と呼ばれるプライマリ VDI アーキテクチャのいずれかで、App-v クライアントを実装するために必要なプロセスの概要について説明します。 App-v システムとそのコンポーネントの計画、展開、操作、および VDI サーバーの運用と管理に精通していることを前提としています。 App-v の詳細については、 [Application Virtualization](https://go.microsoft.com/fwlink/?LinkId=122939) (https://go.microsoft.com/fwlink/?LinkId=122939)

**注** 以下の手順で説明する詳細は、例としてのみ使用されています。 プロセス全体を完了するには、別の方法を使用することができます。

 

## VDI シナリオでの App-v クライアントの展開


VDI シナリオでは、すべてのユーザーに必要なすべてのアプリケーションが設定されている共有の読み取り専用キャッシュを使用して、App-v クライアントを展開することができます。 次に、すべての App-v クライアントで同じキャッシュファイルを使用するように、VDI マスター VM イメージを構成します。 ユーザーには、App-v の公開プロセスを使用して、特定のアプリケーションへのアクセス権が付与されます。 キャッシュは既にすべてのアプリケーションに読み込まれているため、ユーザーがアプリケーションを起動しても、ストリーミングは発生しません。 ただし、キャッシュを事前に作成するために使用されるパッケージは、リアルタイムストリーミングプロトコル (RTSP) ストリーミングをサポートしていて、アプリ V クライアントへのアクセス許可を付与する app-v サーバーに配置する必要があります。 App-v Management Server を使ってアプリケーションを公開する場合は、アプリを使ってこのストリーミング機能を提供できます。

展開プロセスは、次の4つの主要なタスクで構成されます。

-   マスター共有キャッシュファイルの作成と設定

-   共有キャッシュファイルを VDI サーバーストレージにコピーする

-   VDI マスターイメージでの App-v クライアントソフトウェアの構成

-   最初の展開後に共有キャッシュファイルの更新プログラムの展開サイクルを管理する

これらのタスクには慎重に計画する必要があります。 組織的で再現可能なプロセスを準備して文書化することをお勧めします。 これは、マスター共有キャッシュファイルの最初の準備と展開を行うときに特に重要です。また、アプリケーション更新プログラムの進行中の管理については、マスター共有キャッシュの更新が必要になります。 次の手順を使用して、これらの主要なタスクを実行します。

**注** 複数の異なる方法を使用してアプリケーションを公開することはできますが、次の手順は、発行用の App-v Management Server の使用に基づいています。

 

**プールされた VM VDI または静的 VM VDI シナリオで最初の展開用に読み取り専用キャッシュを構成するには**

1. VDI サーバー上の VM で、ユーザー認証と発行のサポートを提供するために、アプリをセットアップして構成します。

2. この Management Server のコンテンツフォルダーに、すべてのユーザーに必要なすべてのアプリケーションパッケージを設定します。

3. App-v クライアントがインストールされているステージングコンピューターをセットアップします。 すべてのアプリケーションに対するアクセス権を持つアカウントでステージングコンピューターにログオンします。これにより、すべてのアプリケーションがコンピューターに公開され、アプリケーションが完全に読み込まれるようにキャッシュにストリーミングされます。

   **重要**  
   ステージングコンピューターでは、App-v クライアントが実行される Vm で使用されているものと同じオペレーティングシステムの種類とシステムアーキテクチャを使用する必要があります。

     

4. セーフモードでステージングコンピューターを再起動して、ドライバーが開始されていないことを確認します。これにより、キャッシュファイルがロックされます。

   **注**  
   または、Application Virtualization サービスを停止して無効にしてから、コンピューターを再起動することもできます。 ファイルのコピーが完了したら、もう一度サービスを有効にして開始してください。

     

5. Sftfs キャッシュファイルを VDI サーバーの SAN にコピーします。このファイルは、共有フォルダー内など、すべての Vm でアクセスできます。 グループの [全員] のアクセス許可を読み取り専用に、キャッシュファイルの更新を管理する管理者にはフルコントロールを設定します。 キャッシュファイルの場所は、レジストリ AppFS\\FileName. から取得できます。

   **重要**  
   FSD ファイルは、ローカルに接続された記憶域のパフォーマンス (たとえば、SAN) に相当する応答性と信頼性を備えた場所に置く必要があります。

     

6. VDI マスター VM イメージに app-v デスクトップクライアントをインストールし、次のレジストリキー値をクライアントの AppFS キーに追加して、読み取り専用キャッシュを使用するように構成します。 AppFS キーは、HKEY \ _LOCAL \ _MACHINE ¥¥¥ \ [Wow6432Node\\\] の各デバイス \\ 365 にあります (¥)。

   <table>
   <colgroup>
   <col width="25%" />
   <col width="25%" />
   <col width="25%" />
   <col width="25%" />
   </colgroup>
   <thead>
   <tr class="header">
   <th align="left">キー</th>
   <th align="left">型</th>
   <th align="left">値</th>
   <th align="left">目的</th>
   </tr>
   </thead>
   <tbody>
   <tr class="odd">
   <td align="left"><p>FileName</p></td>
   <td align="left"><p>String</p></td>
   <td align="left"><p>FSD へのパス</p></td>
   <td align="left"><p>共有キャッシュファイルへのパスを指定します (例 \VDIServername\Sharefolder\SFTFS.FSD (必須)。</p></td>
   </tr>
   <tr class="even">
   <td align="left"><p>ReadOnlyFSD</p></td>
   <td align="left"><p>DWORD</p></td>
   <td align="left"><p>件</p></td>
   <td align="left"><p>読み取り専用モードで動作するようにクライアントを構成します。 これにより、クライアントは、パッケージキャッシュへの更新をストリーム処理しないようになります。 (必須)</p></td>
   </tr>
   <tr class="odd">
   <td align="left"><p>ErrorLogLocation</p></td>
   <td align="left"><p>String</p></td>
   <td align="left"><p>エラーログ (.etl) ファイルのパス</p></td>
   <td align="left"><p>エラーログへのパスを指定するために使用されるエントリ。 勧め. C:\Logs\Sftfs.etl などのローカルパスを使用します。</p></td>
   </tr>
   </tbody>
   </table>

     

7. マスター VM イメージクライアントを構成して、発行サーバーを使用し、ログオン時に公開更新を使用します。 ユーザーが VDI システムにログオンし、その VM がマスター VM イメージから構築されると、公開の更新サイクルが行われ、そのアカウントが承認されているすべてのアプリケーションが公開されます。 これらのアプリケーションは共有キャッシュから実行されます。

**プールされた VM シナリオでパッケージのアップグレードのためにクライアントを構成するには**

1.  アプリケーションパッケージのアップグレードとテストを完了します。

2.  App-v server でパッケージをアップグレードします。 次に、ステージングコンピューター上のクライアントに新しいバージョンのアプリケーションを公開して、キャッシュに完全に読み込まれるようにします。

3.  セーフモードでステージングコンピューターを再起動し、ドライバーが開始されないようにします。

    **注** または、services.msc で Application Virtualization サービスを停止して無効にしてから、コンピューターを再起動することもできます。 ファイルのコピーが完了したら、もう一度サービスを有効にして開始してください。

     

4.  Sftfs キャッシュファイルを VDI サーバーの SAN にコピーします。このファイルは、共有フォルダー内など、すべての Vm でアクセスできます。 たとえば、SFTFS \ _V2 のように、別のファイル名を使うことができます。FSD を作成し、新しいバージョンを区別します。

5.  VDI マスター VM イメージで、更新された共有キャッシュファイルを使用するように App-v デスクトップクライアントを構成するには、\\\\VDIServername\\Sharefolder\\SFTFS\ _V2 などの更新されたファイルの場所を指すように、AppFS レジストリキーのファイル名の値を変更します。FSD. ユーザーがログオフしてから再びログオンすると、更新されたマスターイメージを使用して、新しい VM が作成されます。 すべてのユーザー設定が保持され、新しい VM に適用されます。 その後、更新されたアプリケーションにアクセスできます。

**静的な VM シナリオでパッケージのアップグレードのためにクライアントを構成するには**

1.  アプリケーションパッケージのアップグレードとテストを完了します。

2.  App-v server でパッケージをアップグレードします。 次に、アプリケーションが完全にキャッシュに読み込まれるように、ステージングコンピューター上のクライアントに新しいバージョンのアプリケーションを発行してストリームします。

3.  セーフモードでステージングコンピューターを再起動し、ドライバーが開始されないようにします。

    **注** または、services.msc で Application Virtualization サービスを停止して無効にしてから、コンピューターを再起動することもできます。 ファイルのコピーが完了したら、もう一度サービスを有効にして開始してください。

     

4.  Sftfs キャッシュファイルを VDI サーバーの SAN にコピーします。このファイルは、共有フォルダー内など、すべての Vm でアクセスできます。 たとえば、SFTFS \ _V2 のように、別のファイル名を使うことができます。FSD を作成し、新しいバージョンを区別します。

5.  VDI マスター VM イメージで、更新された共有キャッシュファイルを使用するように App-v デスクトップクライアントを構成するには、\\\\VDIServername\\Sharefolder\\SFTFS\ _V2 などの更新されたファイルの場所を指すように、AppFS レジストリキーのファイル名の値を変更します。FSD. これにより、新しいユーザーが新しいバージョンを入手できるようになります。

6.  更新されたキャッシュの場所 (\\\\VDIServername\\Sharefolder\\SFTFS\ _V2 など) に設定するために、AppFS キーのファイル名の値を編集するスクリプトを作成します。FSD. このスクリプトは、ユーザーがログオフまたはログオフするときに実行されるように構成します。たとえば、グループポリシー設定を使用して、アプリの実行時に実行されるようにします。 ユーザーがログオフして再びログオンすると、既存の VM が更新され、更新されたキャッシュのコピーが使用されます。 その後、更新されたアプリケーションにアクセスできます。

## キャッシュのアップグレード時にシンボリックリンクを使用する方法


新規またはアップグレードされたパッケージを含む新しいキャッシュファイルが展開されるたびに、AppFS キーのファイル名の値を変更する代わりに、次のオペレーティングシステムでは、Windows Vista、Windows 7、Windows Server 2008 のシンボリックリンクを使用できます。 シンボリックリンクの詳細については、「[シンボリックリンク](https://go.microsoft.com/fwlink/?LinkId=157626)()」を参照してください https://go.microsoft.com/fwlink/?LinkId=157626) 。 これに対し、Windows XP では、シンボリックリンクの使用はサポートされていないため、代わりに接合ポイントを使用する必要があります。 接合部の詳細については、「Microsoft サポート技術情報の[記事 205524](https://go.microsoft.com/fwlink/?LinkId=182553) 」 https://go.microsoft.com/fwlink/?LinkId=182553) および「ツール[ジャンクション v 1.05](https://go.microsoft.com/fwlink/?LinkId=182554) (」を参照してください https://go.microsoft.com/fwlink/?LinkId=182554) 。

**キャッシュを参照するためのシンボリックリンクを構成するには**

1.  最初の展開段階で、VDI server ホストオペレーティングシステムのローカル管理者としてコマンドプロンプトウィンドウを開きます。

2.  MKLINK コマンドを使用してシンボリックリンクを作成してから、Sftfs ファイルをポイントするように構成します。

    **     mklink symlinkname \\\\vdihostserver\\sharefolder\\sftfs.fsd**

3.  VDI マスター VM イメージで、[**管理者として実行**] オプションを使用してコマンドプロンプトウィンドウを開き、VM が VDI ホストオペレーティングシステムのシンボリックリンクにアクセスできるようにリモートリンクのアクセス許可を付与します。 既定では、リモートリンクのアクセス許可は無効になっています。

    **fsutil behavior set SymlinkEvaluation R2R: 1**

    **注** ストレージサーバーで、適切なリンクのアクセス許可を有効にする必要があります。 Link の場所と Sftfs fsd ファイルのアクセス許可は、 **L2L:** 1 または**L2R:** 1 または R2L: 1 または: 1 または **:** 1 または**R2R:** 1 のいずれかになります。

     

4.  VDI マスター VM イメージで App-v デスクトップクライアントを構成する場合は、シンボリックリンクを使用している FSD ファイルの UNC パスとして、AppFS key FILENAME の値を設定します。たとえば、\\\\VDIHostserver\\Symlinkname. に設定します。 App-v クライアントが最初にキャッシュにアクセスすると、シンボリックリンクは、キャッシュファイルへのハンドルをクライアントに渡します。 クライアントは、クライアントが実行されている限り、そのハンドルを引き続き使用します。 シンボリックリンクの値は、既存のクライアントに古い共有キャッシュが開かれている場合でも、安全に更新できます。

5.  パッケージをアップグレードするか、新しいパッケージをキャッシュに追加する必要がある場合は、静的な VM またはプールされた VM のシナリオについて、アップグレード手順の 1 ~ 5 の手順に従います。 次に、シンボリックリンクを削除して再作成し、共有キャッシュファイルの新しいバージョンをポイントします。 Vm を再起動すると、更新されたシンボリックリンクを含むパスが使用されるため、クライアントは、更新されたキャッシュのコピーへのハンドルを受け取ります。 次に、ユーザーは新規および更新されたアプリケーションにアクセスできます。

## 関連トピック


[Application Virtualization Management Server をインストールする方法](how-to-install-application-virtualization-management-server.md)

[Application Virtualization Client を手動でインストールする方法](how-to-manually-install-the-application-virtualization-client.md)

[コマンド ラインを使用してクライアントをインストールする方法](how-to-install-the-client-by-using-the-command-line-new.md)

 

 





