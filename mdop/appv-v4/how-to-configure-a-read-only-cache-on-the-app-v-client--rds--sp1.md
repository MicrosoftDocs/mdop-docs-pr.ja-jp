---
title: App-V Client の読み取り専用キャッシュを構成する方法 (RDS)
description: App-V Client の読み取り専用キャッシュを構成する方法 (RDS)
author: dansimp
ms.assetid: b6607fe2-6f92-4567-99f1-d8e3c8a591e0
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, appcompat, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: a44844ae9ffc3497151be7713f6a43fda0ccd8fa
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/26/2020
ms.locfileid: "10817947"
---
# App-V Client の読み取り専用キャッシュを構成する方法 (RDS)


**重要** この手順を使用するには、App-v 4.6 の SP1 を実行している必要があります。

 

すべてのユーザーに必要なすべてのアプリケーションが設定された共有キャッシュを使用して、App-v クライアントを展開することができます。 次に、同じキャッシュファイルを使用するように、App-v リモートデスクトップサービス (RDS) クライアントを構成します。 ユーザーには、App-v の公開プロセスを使用して、特定のアプリケーションへのアクセス権が付与されます。 キャッシュは既にすべてのアプリケーションに読み込まれているため、ユーザーがアプリケーションを起動しても、ストリーミングは発生しません。 ただし、キャッシュを事前に作成するために使用されるパッケージは、リアルタイムストリーミングプロトコル (RTSP) ストリーミングをサポートしていて、アプリ V クライアントへのアクセス許可を付与する app-v サーバーに配置する必要があります。 App-v Management Server を使ってアプリケーションを公開する場合は、アプリを使ってこのストリーミング機能を提供できます。

**注** 以下の手順で説明する詳細は、例としてのみ使用されています。 プロセス全体を完了するには、別の方法を使用することができます。

 

## RDS シナリオでの App-v クライアントの展開


展開プロセスは、次の4つの主要なタスクで構成されます。

-   マスター共有キャッシュファイルの作成と設定

-   共有キャッシュファイルをサーバーストレージにコピーする

-   App-v クライアントソフトウェアの構成

-   最初の展開後に共有キャッシュファイルの更新プログラムの展開サイクルを管理する

これらのタスクには慎重に計画する必要があります。 組織的で再現可能なプロセスを準備して文書化することをお勧めします。 これは、マスター共有キャッシュファイルの準備と展開、およびアプリケーション更新プログラムの継続的な管理のために、マスター共有キャッシュの更新が必要な場合に特に重要です。 次の手順を使用して、これらの主要なタスクを実行します。

**注** 複数の方法を使用してアプリケーションを公開することはできますが、次の手順は、公開のための App-v Management サーバーの使用に基づくものです。

 

**初期展開用に読み取り専用キャッシュを構成するには**

1. ユーザー認証と発行のサポートを提供するように、アプリの管理サーバーをセットアップして構成します。

2. この Management Server のコンテンツフォルダーに、すべてのユーザーに必要なすべてのアプリケーションパッケージを設定します。

3. App-v クライアントがインストールされているステージングコンピューターをセットアップします。 すべてのアプリケーションに対するアクセス権を持つアカウントを使ってステージングコンピューターにログオンします。これにより、すべてのアプリケーションがコンピューターに公開され、アプリケーションが完全に読み込まれるようにキャッシュにストリーミングされます。

   **重要**  
   ステージングコンピューターでは、App-v クライアントが実行される Vm で使用されているものと同じオペレーティングシステムの種類とシステムアーキテクチャを使用する必要があります。

     

4. セーフモードでステージングコンピューターを再起動して、ドライバーが開始されないようにします。これにより、キャッシュファイルがロックされるためです。

   **注**  
   または、Application Virtualization サービスを停止して無効にしてから、コンピューターを再起動することもできます。 ファイルがコピーされたら、もう一度サービスを有効にして開始してください。

     

5. Sftfs fsd キャッシュファイルを SAN にコピーします。このファイルは、すべての RDS サーバーが共有フォルダー内などでアクセスできます。 グループの [全員] のアクセス許可を読み取り専用に、キャッシュファイルの更新を管理する管理者にはフルコントロールを設定します。 キャッシュファイルの場所は、レジストリ AppFS\\FileName. から取得できます。

   **重要**  
   FSD ファイルは、ローカルに接続された記憶域のパフォーマンス (たとえば、SAN) に等しい、応答性と信頼性のある場所に置く必要があります。

     

6. 各 RDS サーバーに App-v RDS クライアントをインストールし、次のレジストリキーの値をクライアントの AppFS キーに追加して、読み取り専用キャッシュを使用するように構成します。 AppFS キーは、HKEY \ _LOCAL \ _MACHINE \\ pc \\ 4、32ビットコンピューターの場合は、HKEY \ _LOCAL \ _MACHINE \\ pc \\ wow6432om¥¥ 64-(ビットコンピューターの場合は、$ 5) \ \ "のように使用します。

   <table>
   <colgroup>
   <col width="25%" />
   <col width="25%" />
   <col width="25%" />
   <col width="25%" />
   </colgroup>
   <thead>
   <tr class="header">
   <th align="left">キー</th>
   <th align="left">型</th>
   <th align="left">値</th>
   <th align="left">目的</th>
   </tr>
   </thead>
   <tbody>
   <tr class="odd">
   <td align="left"><p>FileName</p></td>
   <td align="left"><p>String</p></td>
   <td align="left"><p>FSD のパス</p></td>
   <td align="left"><p>共有キャッシュファイルのパスを指定します (例 \RDSServername\Sharefolder\SFTFS.FSD (必須)。</p></td>
   </tr>
   <tr class="even">
   <td align="left"><p>ReadOnlyFSD</p></td>
   <td align="left"><p>DWORD</p></td>
   <td align="left"><p>件</p></td>
   <td align="left"><p>読み取り専用モードで動作するようにクライアントを構成します。 これにより、クライアントがパッケージキャッシュへの更新をストリームしないようになります。 (必須)</p></td>
   </tr>
   <tr class="odd">
   <td align="left"><p>ErrorLogLocation</p></td>
   <td align="left"><p>String</p></td>
   <td align="left"><p>エラーログ (.etl) ファイルのパス</p></td>
   <td align="left"><p>エラーログのパスを指定するために使用されるエントリ。 勧め. C:\Logs\Sftfs.etl などのローカルパスを使用します。</p></td>
   </tr>
   </tbody>
   </table>

     

7. 発行サーバーを使用し、ユーザーがログオンするときに発行更新を使うように、ファーム内の各 RDS サーバーを構成します。 ユーザーが RDS サーバーにログオンすると、公開更新サイクルが行われ、そのアカウントが承認されているすべてのアプリケーションが公開されます。 これらのアプリケーションは共有キャッシュから実行されます。

**パッケージのアップグレード用に RDS クライアントを構成するには**

1.  アプリケーションパッケージのアップグレードとテストを完了します。

2.  App-v server でパッケージをアップグレードします。 次に、ステージングコンピューター上のクライアントに新しいバージョンのアプリケーションを公開して、キャッシュに完全に読み込まれるようにします。

3.  セーフモードでステージングコンピューターを再起動し、ドライバーが開始されないようにします。

    **注** または、まず、services.msc で Application Virtualization サービスを停止してから無効にしてから、コンピューターを再起動することもできます。 ファイルのコピーが完了したら、もう一度サービスを有効にして開始してください。

     

4.  Sftfs fsd キャッシュファイルを SAN にコピーします。このファイルは、すべての RDS サーバーが共有フォルダー内などでアクセスできます。 別のファイル名を使用できます。たとえば、SFTFS \ _V2 などです。FSD を作成し、新しいバージョンを区別します。

5.  ファーム内の各 RDS サーバーで App-v RDS クライアントを構成して、更新された共有キャッシュファイルを使用するには、\\\\RDSServername\\Sharefolder\\SFTFS\ _V2 など、更新されたファイルの場所を指すように AppFS レジストリキーのファイル名の値を変更します。FSD. これにより、アプリの Vclient ドライバーを再起動したときに、各 RDS server が更新されたキャッシュのコピーを受信することが保証されます。

    **重要** 更新された共有キャッシュファイルを使用するには、RDS サーバーを再起動する必要があります。

     

## キャッシュのアップグレード時にシンボリックリンクを使用する方法


新規またはアップグレードされたパッケージを含む新しいキャッシュファイルが展開されるたびに、AppFS キーのファイル名の値を変更する代わりに、次のオペレーティングシステムでは、Windows Vista、Windows 7、Windows Server 2008 のシンボリックリンクを使用できます。 シンボリックリンクの詳細については、「[シンボリックリンク](https://go.microsoft.com/fwlink/?LinkId=157626)()」を参照してください https://go.microsoft.com/fwlink/?LinkId=157626) 。 これに対し、Windows XP では、シンボリックリンクの使用はサポートされていないため、代わりに接合ポイントを使用する必要があります。 接合部の詳細については、「Microsoft サポート技術情報の[記事 205524](https://go.microsoft.com/fwlink/?LinkId=182553) 」 https://go.microsoft.com/fwlink/?LinkId=182553) および「ツール[ジャンクション v 1.05](https://go.microsoft.com/fwlink/?LinkId=182554) (」を参照してください https://go.microsoft.com/fwlink/?LinkId=182554) 。

**キャッシュを参照するためのシンボリックリンクを構成するには**

1.  最初の展開段階で、RDS server ホストオペレーティングシステムのローカル管理者としてコマンドプロンプトウィンドウを開きます。

2.  MKLINK コマンドを使用してシンボリックリンクを作成してから、Sftfs ファイルをポイントするように構成します。

    **     mklink symlinkname \\\\rdshostserver\\sharefolder\\sftfs.fsd**

3.  VDI マスター VM イメージで、[**管理者として実行**] オプションを使用してコマンドプロンプトウィンドウを開き、VM が VDI ホストオペレーティングシステムのシンボリックリンクにアクセスできるようにリモートリンクのアクセス許可を付与します。 既定では、リモートリンクのアクセス許可は無効になっています。

    **fsutil behavior set SymlinkEvaluation R2R: 1**

    **注** ストレージサーバーで、適切なリンクのアクセス許可を有効にする必要があります。 Link の場所と Sftfs fsd ファイルのアクセス許可は、 **L2L:** 1 または**L2R:** 1 または R2L: 1 または: 1 または **:** 1 または**R2R:** 1 のいずれかになります。

     

4.  App-v RDS クライアントを構成する場合は、シンボリックリンクを使用している FSD ファイルの UNC パスに、AppFS key FILENAME の値を設定します。 たとえば、ファイル名を \\\\VDIHostserver\\Symlinkname. に設定します。 App-v クライアントが最初にキャッシュにアクセスすると、シンボリックリンクは、キャッシュファイルへのハンドルをクライアントに渡します。 クライアントは、クライアントが実行されている限り、そのハンドルを引き続き使用します。 シンボリックリンクの値は、既存のクライアントに古い共有キャッシュが開かれている場合でも、安全に更新できます。

5.  パッケージをアップグレードするか、新しいパッケージをキャッシュに追加する必要がある場合は、アップグレード手順の手順 1 ~ 4 に従います。 次に、シンボリックリンクを削除して再作成し、共有キャッシュファイルの新しいバージョンをポイントします。 これにより、各 RDS server は、App-v クライアントドライバーが再起動したときに、更新されたキャッシュのコピーを受信することが保証されます。 RDS サーバーが再起動されると、更新されたシンボリックリンクを含むパスがクライアントによって使用されるため、App-v クライアントは、更新されたキャッシュのコピーへのハンドルを受け取ります。 次に、ユーザーは新規および更新されたアプリケーションにアクセスできます。

## 関連トピック


[Application Virtualization Management Server をインストールする方法](how-to-install-application-virtualization-management-server.md)

[Application Virtualization Client を手動でインストールする方法](how-to-manually-install-the-application-virtualization-client.md)

[コマンド ラインを使用してクライアントをインストールする方法](how-to-install-the-client-by-using-the-command-line-new.md)

 

 





